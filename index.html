<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Loan Tracker (LIVE)</title>

<style>
body {font-family: Arial, sans-serif; background:#f4f6f8; padding:20px;}
h1{text-align:center}
.container{max-width:900px;margin:auto}
.card{background:#fff;padding:20px;margin-bottom:20px;border-radius:8px;box-shadow:0 2px 6px rgba(0,0,0,.1)}
table{width:100%;border-collapse:collapse;margin-top:10px}
th,td{border:1px solid #ddd;padding:8px;text-align:center}
th{background:#1a73e8;color:#fff}
.paid{color:green;font-weight:bold}
button{padding:8px 14px;margin:4px;cursor:pointer;border-radius:4px;border:none}
.add-button{background:#1a73e8;color:#fff}
#adminForm,#adminControls{text-align:center}
#addForm input{margin:4px 0;padding:6px;width:220px}
</style>
</head>

<body>

<h1>ðŸ“‹ Loan & Payment Dashboard (LIVE)</h1>

<!-- ADMIN LOGIN -->
<div id="adminForm">
  <h2>Admin Login</h2>
  <input id="adminUser" placeholder="Username"><br>
  <input id="adminPass" type="password" placeholder="Password"><br><br>
  <button class="add-button" onclick="login()">Login</button>
</div>

<!-- ADMIN CONTROLS -->
<div id="adminControls" style="display:none">
  <button class="add-button" onclick="toggleForm()">Add Borrower</button>
  <div id="addForm" style="display:none">
    <input id="name" placeholder="Borrower Name"><br>
    <input id="amount" type="number" placeholder="Loan Amount"><br>
    <input id="months" type="number" placeholder="Months to Pay"><br>
    <input id="release" type="date"><br><br>
    <button class="add-button" onclick="addBorrower()">Save Borrower</button>
  </div>
</div>

<div class="container" id="list"></div>

<!-- FIREBASE SDKs -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<script>
/* ðŸ”¥ FIREBASE CONFIG (YOURS) */
const firebaseConfig = {
  apiKey: "AIzaSyBzpiOc27Qy0125-Bq1mDC0e-A3wge4U0g",
  authDomain: "liveproject-5205a.firebaseapp.com",
  databaseURL: "https://liveproject-5205a-default-rtdb.firebaseio.com",
  projectId: "liveproject-5205a",
  storageBucket: "liveproject-5205a.firebasestorage.app",
  messagingSenderId: "616393341334",
  appId: "1:616393341334:web:3a9681561c8c24a85385b7"
};

/* INIT FIREBASE */
firebase.initializeApp(firebaseConfig);
const db = firebase.database();
const borrowersRef = db.ref("borrowers");

/* ADMIN */
const ADMIN = { user:"Yuna@081724", pass:"Yuna@081724" };
let isAdmin = false;

function login(){
  if(adminUser.value===ADMIN.user && adminPass.value===ADMIN.pass){
    isAdmin = true;
    adminForm.style.display="none";
    adminControls.style.display="block";
  } else alert("Wrong login");
}

function toggleForm(){
  addForm.style.display = addForm.style.display==="none"?"block":"none";
}

/* ADD BORROWER */
function addBorrower(){
  if(!isAdmin) return;
  if(!name.value || !amount.value || !months.value || !release.value)
    return alert("Complete all fields");

  borrowersRef.push({
    name: name.value,
    amount: +amount.value,
    months: +months.value,
    release: release.value,
    paid: 0,
    created: Date.now()
  });

  name.value = amount.value = months.value = release.value = "";
}

/* LIVE LISTENER (AUTO UPDATE) */
borrowersRef.on("value", snap=>{
  list.innerHTML="";
  const data = snap.val();
  if(!data) return;

  Object.entries(data).forEach(([id,b])=>{
    const total = b.amount + (b.amount * 0.05 * b.months);
    const monthly = total / b.months;
    const half = monthly / 2;

    const card = document.createElement("div");
    card.className="card";
    card.innerHTML = `
      <h3>${b.name}</h3>
      <p>Loan Amount: â‚±${b.amount}</p>
      <p>Months: ${b.months}</p>
      <p>Release Date: ${b.release}</p>
      <p>Interest: 5% monthly</p>
      <p><b>Total w/ Interest: â‚±${total.toFixed(2)}</b></p>

      <table>
        <tr><th>Payment</th><th>Amount</th><th>Status</th></tr>
        ${[...Array(b.months*2)].map((_,i)=>`
          <tr>
            <td>${i+1}</td>
            <td>â‚±${half.toFixed(2)}</td>
            <td>${i < b.paid ? "<span class='paid'>PAID</span>" :
              isAdmin ? `<button onclick="pay('${id}')">Pay</button>` : ""}</td>
          </tr>`).join("")}
      </table>

      ${isAdmin ? `<button class="add-button" onclick="removeBorrower('${id}')">Delete</button>` : ""}
    `;
    list.appendChild(card);
  });
});

/* PAY */
function pay(id){
  borrowersRef.child(id).once("value", snap=>{
    const b = snap.val();
    borrowersRef.child(id).update({ paid: b.paid + 1 });
  });
}

/* DELETE */
function removeBorrower(id){
  if(confirm("Delete borrower?")){
    borrowersRef.child(id).remove();
  }
}
</script>

</body>
</html>
